<?xml version="1.0" encoding="UTF-8" ?>
<!--
  ~ Copyright (c) 2018 杭州端点网络科技有限公司, Code generated by terminus code gen
  -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="BackCategory">

    <sql id="queryCondition">
        where 1 = 1

        <if test="status != null">and `status` = #{status}</if>
        <if test="startAt != null">and created_at &gt; #{startAt}</if>
        <if test="endAt != null">and created_at &lt; #{endAt}</if>
    </sql>

    <select id="paging" parameterType="list" resultMap="BackCategoryMap">
        select id, <include refid="cols_exclude_id"/>
        from <include refid="tb"/>
        <include refid="queryCondition"/>
        order by id desc limit #{offset},#{limit}
    </select>

    <select id="count" parameterType="list" resultType="long">
        select count(1)
        from <include refid="tb"/>
        <include refid="queryCondition"/>
    </select>

    <select id="pagingByNotSync" parameterType="list" resultMap="BackCategoryMap">
        select t1.id, t1.pid, t1.name
        from <include refid="tb"/> t1 left join vega_item_sync t2 on t1.id = t2.sync_id and t2.channel = #{channel} and t2.type = #{type}
        where 1 = 1
        <if test="status != null">and t1.status = #{status}</if>
        and t2.sync_id is null
        order by t1.id desc limit #{offset},#{limit}
    </select>

    <select id="countByNotSync" parameterType="list" resultType="long">
        select count(1)
        from <include refid="tb"/> t1 left join vega_item_sync t2 on t1.id = t2.sync_id and t2.channel = #{channel} and t2.type = #{type}
        where 1 = 1
        <if test="status != null">and t1.status = #{status}</if>
        and t2.sync_id is null
    </select>

</mapper>